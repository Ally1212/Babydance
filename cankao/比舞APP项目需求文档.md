# 比舞APP项目需求文档

## 项目概述

比舞APP是一款专为舞蹈学习和对比而设计的移动应用，主要功能是通过视频并排播放对比，帮助用户学习和改进舞蹈技巧。

## 核心功能需求

### 1. 视频并排播放对比
- **功能描述**：支持两个视频同时播放，左右或上下并排显示
- **技术要点**：
  - 双视频同步播放控制
  - 布局自适应（横屏/竖屏）
  - 视频尺寸调整和缩放
- **用户场景**：用户可以将自己的舞蹈视频与教学视频进行实时对比

### 2. 音乐自动对齐
- **功能描述**：检测两个视频的音乐节拍，实现自动对齐播放
- **技术要点**：
  - 音频波形分析
  - 节拍检测算法
  - 时间轴自动校准
- **用户场景**：确保两个视频的音乐节拍同步，便于动作对比

### 3. 片段循环播放
- **功能描述**：用户可以设置视频中任意时间段进行循环播放
- **技术要点**：
  - 精确的时间点选择
  - 无缝循环播放
  - 起始点标记和保存
- **用户场景**：重复练习某个舞蹈动作片段

### 4. 可交互时间轴
- **功能描述**：视频下方显示时间轴，支持多种交互操作
- **子功能**：
  - **缩放功能**：时间轴可以放大缩小，精确到帧级别
  - **拖拽播放**：拖动时间轴指针快速定位视频位置
  - **进度显示**：实时显示当前播放进度
- **技术要点**：
  - 自定义时间轴控件
  - 手势识别（缩放、拖拽）
  - 帧精度控制

### 5. 倍速播放
- **功能描述**：支持多种播放速度选择
- **速度选项**：1×（正常）、0.8×（慢速）、0.6×（超慢速）
- **技术要点**：
  - 音频变速不变调
  - 视频帧率调整
  - 同步播放控制
- **用户场景**：慢速播放便于观察细节动作

### 6. 时间轴批注功能
- **功能描述**：允许用户在时间轴上添加文字或语音批注
- **子功能**：
  - 文字批注：在特定时间点添加文字说明
  - 语音批注：录制语音备注
  - 批注管理：编辑、删除、导出批注
- **技术要点**：
  - 时间点精确定位
  - 批注数据存储
  - 音频录制和播放
- **用户场景**：记录学习心得、动作要点提醒

## 技术架构建议

### 前端框架
- **Flutter**：跨平台开发，基于现有flexible脚手架
- **视频播放**：video_player插件 + 自定义控制器
- **音频处理**：audioplayers + flutter_audio_waveforms

### 核心技术栈
```
├── 视频处理
│   ├── video_player (视频播放)
│   ├── ffmpeg_kit_flutter (视频处理)
│   └── camera (视频录制)
├── 音频处理
│   ├── audioplayers (音频播放)
│   ├── record (音频录制)
│   └── flutter_audio_waveforms (波形分析)
├── UI组件
│   ├── 自定义时间轴控件
│   ├── 双视频播放器
│   └── 批注管理界面
└── 数据存储
    ├── sqflite (本地数据库)
    └── shared_preferences (配置存储)
```

## 页面结构设计

```
比舞APP/
├── 首页
│   ├── 视频导入
│   ├── 历史记录
│   └── 设置入口
├── 比较页面
│   ├── 双视频播放区域
│   ├── 播放控制栏
│   ├── 时间轴组件
│   └── 批注面板
├── 设置页面
│   ├── 播放设置
│   ├── 音频设置
│   └── 批注设置
└── 批注管理
    ├── 批注列表
    ├── 批注编辑
    └── 批注导出
```

## 开发优先级

### Phase 1 - 基础功能（MVP）
1. 视频并排播放
2. 基础播放控制
3. 简单时间轴

### Phase 2 - 核心功能
1. 片段循环播放
2. 倍速播放
3. 时间轴缩放拖拽

### Phase 3 - 高级功能
1. 音乐自动对齐
2. 时间轴批注
3. 数据导出功能

## 技术难点分析

### 1. 双视频同步播放
- **挑战**：确保两个视频完全同步
- **解决方案**：统一时间控制器，定时器同步

### 2. 音频节拍检测
- **挑战**：准确识别音乐节拍
- **解决方案**：使用FFT算法进行频域分析

### 3. 时间轴精确控制
- **挑战**：帧级别的精确定位
- **解决方案**：自定义播放器控制器

### 4. 性能优化
- **挑战**：双视频播放的性能消耗
- **解决方案**：视频预加载、内存管理优化

## 用户体验设计

### 交互设计原则
- **直观性**：操作简单明了
- **响应性**：实时反馈用户操作
- **一致性**：统一的交互模式

### 界面布局
- **横屏模式**：左右并排显示视频
- **竖屏模式**：上下堆叠显示视频
- **自适应**：根据视频比例自动调整

## 数据存储方案

### 本地存储
```sql
-- 项目表
CREATE TABLE projects (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    created_at DATETIME,
    updated_at DATETIME
);

-- 视频表
CREATE TABLE videos (
    id INTEGER PRIMARY KEY,
    project_id INTEGER,
    file_path TEXT NOT NULL,
    duration REAL,
    FOREIGN KEY (project_id) REFERENCES projects (id)
);

-- 批注表
CREATE TABLE annotations (
    id INTEGER PRIMARY KEY,
    project_id INTEGER,
    timestamp REAL NOT NULL,
    type TEXT NOT NULL, -- 'text' or 'audio'
    content TEXT,
    audio_path TEXT,
    FOREIGN KEY (project_id) REFERENCES projects (id)
);
```

## 测试计划

### 功能测试
- [ ] 视频导入和播放
- [ ] 双视频同步性测试
- [ ] 时间轴操作测试
- [ ] 批注功能测试

### 性能测试
- [ ] 内存使用监控
- [ ] 电池消耗测试
- [ ] 不同设备适配测试

### 兼容性测试
- [ ] iOS/Android平台测试
- [ ] 不同视频格式支持
- [ ] 不同屏幕尺寸适配

## 项目时间规划

| 阶段 | 功能 | 预估时间 |
|------|------|----------|
| Phase 1 | 基础播放功能 | 2-3周 |
| Phase 2 | 核心交互功能 | 3-4周 |
| Phase 3 | 高级功能 | 4-5周 |
| 测试优化 | 全面测试和优化 | 2-3周 |

## 后续扩展功能

### 社交功能
- 作品分享
- 用户评论
- 学习社区

### AI功能
- 动作识别和评分
- 智能批注建议
- 个性化推荐

### 云端功能
- 云端存储
- 多设备同步
- 在线协作

---

*本文档将随着项目进展持续更新和完善*